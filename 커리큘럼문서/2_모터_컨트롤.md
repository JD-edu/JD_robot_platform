## ESP32 모터 제어 

### JD 로봇 플랫폼의 4바퀴로봇 소개 

### 4바퀴로봇 조립하기 

### ESP32 제어보드 구성 

### 모터제어 해보기 
이번에는 조립된 4바퀴로봇을 코딩해서 모터를 제어해 보도록 하겠습니다. 모터를 제어하는 방식은 시리얼 포트를 통해서 PC에서 명령을 내리면 이 명령을 4바퀴로봇의 ESP32 제어보드가 받아서 모터를 제어하는 방식입니다.  깃허브에서 다운로드 받은 소스코드 중에서 "102_esp32_motor_control" 폴더에 102_esp32_motor_control.ino 소스코드 파일을 아두이노 IDE 파일 -> 열기 로 엽니다. 이 소스코드는 4바퀴로봇에 연결되어 있는 4개의 모터를 제어할 수 있는 동작실킬 수 있도록 해 줍니다. 

#### setup() 함수 
setup()함수에서는 시리얼을 115200 속도로 통신할 수 있도록 열어 줍니다. 그리고 시작 메시지를 출력합니다. 

```C
    Serial.begin(115200);
    Serial.print("motor test start...");
```

그 다음에는 pinMode() 함수를 시용하여 모터를 제어하는 IO들을 출력으로 셋팅합니다. 4바퀴로봇은 모듀 8개의 IO를 사용합니다. 1개의 모터를 전진 후진 제어를 허기위해서는 2개의 IO가 필요해서 모두 8개의 IO가 필여합니다. 모터제어 사용되는 IO는 숫자보다는 #define 을 사용해서 이름을 정의해서 사용합니다. 

```C

    #define M1_B    26
    #define M1_A    27
    #define M2_B    12
    #define M2_A    14
    #define M3_B    15
    #define M3_A    2
    #define M4_B    4
    #define M4_A    16

    pinMode(M1_A, OUTPUT);
    pinMode(M1_B, OUTPUT);
    pinMode(M2_A, OUTPUT);
    pinMode(M2_B, OUTPUT);
    pinMode(M3_A, OUTPUT);
    pinMode(M3_B, OUTPUT);
    pinMode(M4_A, OUTPUT);
    pinMode(M4_B, OUTPUT);
```

#### 모터제어 함수 
코드를 잘 정리하기 위해서 모터제어 코드들은 함수로 묶습니다. 모터제어 함수는 전진, 후진, 좌회전, 우호전, 정지 기능이 있습니다. 
4개의 모터를 모두 전진하는 방향으로 회전시키려면 다음과 같이 digitalWrite()함수를 사용합니다. 

```C
void go_forward(){
  Serial.println("forward");
  digitalWrite(M1_A, LOW);
  digitalWrite(M1_B, HIGH);
  digitalWrite(M2_A, LOW);
  digitalWrite(M2_B, HIGH);

  digitalWrite(M3_A, HIGH);
  digitalWrite(M3_B, LOW);
  digitalWrite(M4_A, HIGH);
  digitalWrite(M4_B, LOW);
}
```
모터제어용 IC는 2개의 ESP32 IO를 사용하는데 예를 들어 모터1번은 M1_A, M1_B 두개의 신호를 사용합니다. 모터는 다음표와 같아 제어 됩니다. 

|모터1 동작|M1_A|M1_B|
|------|---|---|
|전진|LOW|HIGH|
|후진|HIGH|LOW|
|멈춤|LOW|LOW|
